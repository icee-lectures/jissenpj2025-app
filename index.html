<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame VR 移動テスト</title>
    
    <!-- 外部ライブラリ -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
    
    <!-- カスタムスタイル -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- カスタムコンポーネント -->
    <script src="js/components.js"></script>
    
    <!-- ゲームロジック -->
    <script src="js/game.js"></script>
  </head>
  <body>
    <a-scene>
      <a-entity light="type: ambient; intensity: 1"></a-entity>
      <a-entity light="type: directional; intensity: 0.7" position="1 3 2"></a-entity>

      <!-- カメラとカーソル -->
      <a-entity camera look-controls position="0 1.6 -3.2" thumbstick-move>
        <a-entity 
          cursor="fuse: false; rayOrigin: entity"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
          material="color: #FF0000; shader: flat">
        </a-entity>
      </a-entity>

      <!-- 空（青色） -->
      <a-sky color="#87CEEB"></a-sky>

      <!-- 地面（緑色） -->
      <a-plane rotation="-90 0 0" width="100" height="100" color="#228B22"></a-plane>

      <!-- 机の上の2枚の板（間に小さい隙間） -->
      <a-box position="0 1.11 -4.03" width="0.5" height="0.02" depth="0.1" color="#D2B48C"></a-box>
      <a-box position="0 1.11 -3.89" width="0.5" height="0.02" depth="0.1" color="#DEB887"></a-box>
      <!-- 隙間クリック用の透明オブジェクトを20分割で配置 -->
      <a-entity id="gap-colliders"></a-entity>

      <!-- 右手コントローラー -->
<a-entity id="rightHand" laser-controls="hand: right" raycaster="objects: .clickable">
        <!-- 棒本体 -->
        <a-cylinder position="0 0 -0.3" radius="0.01" height="0.6" color="#888"></a-cylinder>
        <!-- 先端の球体（コリジョン判定用） -->
        <a-sphere id="stickTip" position="0 0 -0.3" radius="0.03" color="#F00"
                  dynamic-body="shape: sphere; mass: 0"
                  stick-tip-listener></a-sphere>
      </a-entity>
      <!-- 左手コントローラー -->
      <a-entity laser-controls="hand: left" raycaster="objects: .clickable"></a-entity>

      <!-- お手本ボタン -->
      <a-box id="demo-btn" position="0.5 1.16 -4" width="0.2" height="0.04" depth="0.1" color="#66ccff" class="clickable">
        <a-text value="お手本" align="center" color="#000" position="0 0.03 0"></a-text>
      </a-box>
      <a-text value="お手本を再現" align="center" color="#000" position="0.5 1.30 -3.95" width="1"></a-text>

      <!-- リセットボタン -->
      <a-box id="reset-btn" position="0.8 1.16 -4" width="0.2" height="0.04" depth="0.1" color="#ffcc00" class="clickable">
        <a-text value="リセット" align="center" color="#000" position="0 0.03 0"></a-text>
      </a-box>
      <a-text value="やり直し" align="center" color="#000" position="0.8 1.30 -3.95" width="100"></a-text>

      <!-- リプレイボタン -->
      <a-box id="replay-btn" position="0.5 1.16 -3.8" width="0.2" height="0.04" depth="0.1" color="#ff8888" class="clickable">
        <a-text value="リプレイ" align="center" color="#000" position="0 0.03 0"></a-text>
      </a-box>
      <a-text value="動きを再生" align="center" color="#000" position="0.5 1.30 -3.75" width="1"></a-text>

      <!-- 埋めた数を表示するテキスト -->
      <a-text id="fill-count-text" value="埋めた数: 0 / 70" position="-0.9 2.0 -4.5" color="#222" width="2"></a-text>

      <!-- グラフ用canvas（非表示） -->
      <canvas id="speed-graph" width="300" height="150"></canvas>
      <!-- グラフ表示用a-plane -->
      <a-plane id="graph-plane" position="0.8 2.0 -4.5" width="0.6" height="0.3" material="side:double"></a-plane>

      <!-- 机の上に仮想カメラを設置 -->
      <a-entity id="table-cam" camera="active: false" position="0 1.3 -3.97" rotation="-90 0 0"></a-entity>
      <a-plane id="screen" position="1.5 1.5 -4" width="1" height="0.75" tablecam-to-screen></a-plane>

      <!-- 横からのカメラ -->
      <a-entity id="side-cam" camera="active: false" position="-0.3 1.13 -3.96" rotation="0 -90 0"></a-entity>
      <a-plane id="side-screen" position="-1.5 1.5 -4" width="1" height="0.75" sidecam-to-screen></a-plane>

      <!-- STLモデル -->
      <a-entity stl-model="src: url(Part1.STL)" position="-0.25 1.13 -4" scale="0.02 0.02 0.02" color="#ff8800"></a-entity>
      <a-entity stl-model="src: url(Part2.STL)" position="0.25 1.13 -4" scale="0.02 0.02 0.02" color="#0088ff"></a-entity>
      
      <!-- GLBモデル -->
      <a-entity id="deskModel" gltf-model="deskModel.glb" position="0 1.15 -4.2" scale="1.3 1.3 1.3"></a-entity>
      <a-entity id="arkModel" gltf-model="ark.blend.glb" position="0.53 1.52 -4.45" scale="0.01 0.01 0.01"></a-entity>
    </a-scene>
  </body>
</html>
