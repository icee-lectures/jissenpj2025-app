<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR空間・スティック移動デモ</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script>
      // スティックで前後左右移動＋入力可視化
      AFRAME.registerComponent('thumbstick-move', {
        schema: {speed: {default: 0.07}},
        init: function () {
          this.cameraEl = document.querySelector('[camera]');
          // 既存の球体を取得
          this.indicator = this.el.querySelector('#stick-indicator');

          this.el.addEventListener('thumbstickmoved', (evt) => {
            // 球体の色を入力方向で変化
            if (Math.abs(evt.detail.x) > 0.1) {
              this.indicator.setAttribute('color', '#FF0000');
            } else {
              this.indicator.setAttribute('color', '#00FF00');
            }
            // カメラを左右移動（x方向のみ）
            const cam = this.cameraEl.object3D;
            const dir = new THREE.Vector3();
            cam.getWorldDirection(dir);
            dir.y = 0;
            dir.normalize();
            const right = new THREE.Vector3();
            right.crossVectors(dir, cam.up).normalize();
            const moveX = evt.detail.x * this.data.speed;
            cam.position.x += right.x * moveX;
            cam.position.z += right.z * moveX;
          });
          // 離したら色を戻す
          this.el.addEventListener('thumbstickchanged', () => {
            this.indicator.setAttribute('color', '#00FF00');
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true">
      <!-- 空 -->
      <a-sky color="#87CEEB"></a-sky>
      <!-- 地面 -->
      <a-plane rotation="-90 0 0" width="30" height="30" color="#8B5A2B"></a-plane>
      <!-- 壁 -->
      <a-box position="0 2 -15" width="30" height="4" depth="0.2" color="#b0b0b0"></a-box>
      <a-box position="0 2 15" width="30" height="4" depth="0.2" color="#b0b0b0"></a-box>
      <a-box position="-15 2 0" width="0.2" height="4" depth="30" color="#b0b0b0"></a-box>
      <a-box position="15 2 0" width="0.2" height="4" depth="30" color="#b0b0b0"></a-box>
      <!-- カメラ（ユーザー） -->
      <a-entity camera look-controls wasd-controls position="0 1.6 0"></a-entity>
      <a-entity laser-controls="hand: left" thumbstick-move>
        <a-sphere id="stick-indicator" radius="0.1" color="#00FF00" position="0 0 -0.3"></a-sphere>
      </a-entity>
    </a-scene>
  </body>
</html>